---
title: "IS 507 Final Project Report"
subtitle: "From Check-In to Landing: How Airline Operations Shape Passenger Satisfaction"
author: "Shaotong Zhang, LiYi Hsu, Jack Liu, Yiming Ma, Jiaqi Gao"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: false
    fig_caption: true
    latex_engine: pdflatex
header-includes:
  - \usepackage{float}
  - \usepackage{placeins}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 6)
```

## 1. Introduction

In today's aviation industry, passenger satisfaction has increasingly become an important competitive indicator for airlines. However, passenger satisfaction, as a relatively subjective indicator, is often difficult to comprehensively measure and predict due to the interaction of multiple factors such as age, travel purpose, cabin class, and in-flight service quality. This has brought great challenges to airlines on how to improve services to better meet passenger needs and enhance customer loyalty. A systematic data-driven approach helps determine how these elements jointly impact passenger satisfaction. Through data analysis, airlines can design targeted strategies to improve satisfaction and retain more customers.

We structure our analysis around five research questions.

1. What is the relationship between passengers' overall satisfaction and their age as well as service demands?
2. Do passengers place higher ratings or importance on "entertainment" and "catering" for longer flights?
3. How do departure and arrival delays influence passenger satisfaction differently between loyal and disloyal customers?
4. What are the moderating effects of the intersection of cabin class and flight distance on certain service attributes and passenger satisfaction?
5. Can we accurately predict passenger satisfaction, and which factors are the most important predictors?

## 2. Dataset Overview

This study uses the Airline Passenger Satisfaction dataset from Kaggle, which includes responses from real air passengers. The dataset contains a training set of 103,904 records and a test set of 25,976 records, each with 25 variables describing passenger demographics and flight experiences.

Key variables include gender, age, customer type, travel type, cabin class, and flight distance, along with 14 service-related ratings (e.g., seat comfort, cleanliness, food and drink, Wi-Fi service) measured on a 0–5 scale. Flight delays are also recorded. The dependent variable “Satisfaction” is binary: “satisfied” vs. “neutral/dissatisfied”. These variables together provide a solid foundation for exploring the relationships between service dimensions, demographics, and satisfaction outcomes.

```{r data-prep, include=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(broom)

read_one <- function(path, tag) {
  readr::read_csv(path, show_col_types = FALSE) |>
    dplyr::mutate(.dataset = tag)
}

train_df <- read_one("dataset/train.csv", "train")
test_df  <- read_one("dataset/test.csv",  "test")
raw_df   <- dplyr::bind_rows(train_df, test_df)

service_columns <- c(
  "Inflight wifi service",
  "Departure/Arrival time convenient",
  "Ease of Online booking",
  "Gate location",
  "Food and drink",
  "Online boarding",
  "Seat comfort",
  "Inflight entertainment",
  "On-board service",
  "Leg room service",
  "Baggage handling",
  "Checkin service",
  "Inflight service",
  "Cleanliness"
)
service_columns <- intersect(service_columns, colnames(raw_df))

age_breaks <- c(-Inf, 17, 25, 35, 45, 55, 65, Inf)
age_labels <- c("<18", "18-25", "26-35", "36-45", "46-55", "56-65", "66+")

df <- raw_df |>
  dplyr::filter(!is.na(Age)) |>
  dplyr::mutate(
    age_group = cut(Age, breaks = age_breaks, labels = age_labels, right = TRUE, ordered_result = TRUE)
  ) |>
  dplyr::mutate(dplyr::across(dplyr::all_of(service_columns), as.numeric))

long_scores <- df |>
  tidyr::pivot_longer(
    cols = dplyr::all_of(service_columns),
    names_to = "service",
    values_to = "score"
  ) |>
  dplyr::mutate(score = dplyr::na_if(score, 0))

summary_scores <- long_scores |>
  dplyr::group_by(age_group, service) |>
  dplyr::summarise(
    mean_score = mean(score, na.rm = TRUE),
    n_rated = sum(!is.na(score)),
    .groups = "drop"
  )

topk <- 5
top5_by_age <- summary_scores |>
  dplyr::group_by(age_group) |>
  dplyr::arrange(dplyr::desc(mean_score), .by_group = TRUE) |>
  dplyr::slice_head(n = topk) |>
  dplyr::ungroup() |>
  dplyr::mutate(service = forcats::fct_reorder(service, mean_score))

available_age_groups <- unique(na.omit(df$age_group))
available_age_groups <- available_age_groups[order(available_age_groups)]
ks_pair <- as.character(c(head(available_age_groups, 1), tail(available_age_groups, 1)))

ks_results <- NULL
if (length(ks_pair) == 2) {
  ks_results <- purrr::map_dfr(service_columns, function(sv) {
    sub_data <- long_scores |>
      dplyr::filter(service == sv, !is.na(age_group), !is.na(score), age_group %in% ks_pair)
    g1 <- sub_data |>
      dplyr::filter(age_group == ks_pair[1]) |>
      dplyr::pull(score)
    g2 <- sub_data |>
      dplyr::filter(age_group == ks_pair[2]) |>
      dplyr::pull(score)
    if (length(g1) >= 10 && length(g2) >= 10) {
      ks <- suppressWarnings(stats::ks.test(g1, g2))
      tibble::tibble(
        service = sv,
        group_a = ks_pair[1],
        group_b = ks_pair[2],
        statistic = unname(ks$statistic),
        p_value = ks$p.value
      )
    } else {
      tibble::tibble(
        service = sv,
        group_a = ks_pair[1],
        group_b = ks_pair[2],
        statistic = NA_real_,
        p_value = NA_real_
      )
    }
  })
}

logit_df <- df |>
  dplyr::mutate(
    satisfaction_binary = dplyr::case_when(
      !is.na(satisfaction) & satisfaction == "satisfied" ~ 1L,
      !is.na(satisfaction) ~ 0L,
      TRUE ~ NA_integer_
    )
  ) |>
  dplyr::mutate(dplyr::across(dplyr::all_of(service_columns), ~ dplyr::na_if(.x, 0))) |>
  dplyr::select(satisfaction_binary, age_group, dplyr::all_of(service_columns)) |>
  tidyr::drop_na()

logit_top_terms <- NULL
if (nrow(logit_df) > 100) {
  rhs <- paste(c("age_group", paste0("`", service_columns, "`")), collapse = " + ")
  fml <- stats::as.formula(paste0("satisfaction_binary ~ ", rhs))
  logit_fit <- stats::glm(fml, data = logit_df, family = stats::binomial())
  logit_tidy <- broom::tidy(logit_fit, conf.int = TRUE, exponentiate = TRUE) |>
    dplyr::mutate(
      term_clean = stringr::str_replace_all(term, "`", ""),
      is_age = stringr::str_starts(term_clean, "age_group")
    ) |>
    dplyr::filter(term != "(Intercept)")
  logit_top_terms <- logit_tidy |>
    dplyr::arrange(p.value) |>
    dplyr::slice_head(n = 20) |>
    dplyr::mutate(term_clean = forcats::fct_reorder(term_clean, estimate))
}

# Q4: Cabin Class × Flight Distance Analysis
cabin_col <- dplyr::coalesce(
  if ("Class" %in% colnames(raw_df)) "Class" else NULL,
  if ("Cabin.Class" %in% colnames(raw_df)) "Cabin.Class" else NULL,
  grep("class|Class", colnames(raw_df), ignore.case = TRUE, value = TRUE)[1]
)

distance_var <- dplyr::case_when(
  "Flight.Distance" %in% colnames(raw_df) ~ "Flight.Distance",
  "Flight Distance" %in% colnames(raw_df) ~ "Flight Distance",
  TRUE ~ NA_character_
)

df_q4 <- raw_df |>
  dplyr::filter(!is.na(.data[[cabin_col]])) |>
  dplyr::mutate(
    satisfaction_binary_q4 = dplyr::case_when(
      !is.na(satisfaction) & satisfaction == "satisfied" ~ 1L,
      !is.na(satisfaction) ~ 0L,
      TRUE ~ NA_integer_
    )
  )

if (!is.na(distance_var)) {
  df_q4 <- df_q4 |>
    dplyr::filter(!is.na(.data[[distance_var]])) |>
    dplyr::mutate(
      distance_category = cut(
        .data[[distance_var]],
        breaks = c(0, 1000, 3000, Inf),
        labels = c("Short-haul (<1000km)", "Medium-haul (1000-3000km)", "Long-haul (>3000km)"),
        include.lowest = TRUE
      ),
      cabin_distance = interaction(.data[[cabin_col]], distance_category, sep = " × ", drop = TRUE),
      cabin_factor = as.factor(.data[[cabin_col]]),
      distance_factor = as.factor(distance_category)
    ) |>
    dplyr::mutate(dplyr::across(dplyr::all_of(service_columns), ~ dplyr::na_if(as.numeric(.x), 0)))
}

# Q4 Heatmap data
heatmap_q4 <- NULL
if (exists("df_q4") && "cabin_distance" %in% colnames(df_q4)) {
  heatmap_q4 <- df_q4 |>
    tidyr::pivot_longer(
      cols = dplyr::all_of(service_columns),
      names_to = "service",
      values_to = "score"
    ) |>
    dplyr::group_by(cabin_distance, service) |>
    dplyr::summarise(
      mean_score = mean(score, na.rm = TRUE),
      .groups = "drop"
    )
}

# Q4 Top-5 by cabin_distance
top5_q4 <- NULL
if (!is.null(heatmap_q4)) {
  top5_q4 <- heatmap_q4 |>
    dplyr::group_by(cabin_distance) |>
    dplyr::arrange(dplyr::desc(mean_score), .by_group = TRUE) |>
    dplyr::slice_head(n = 5) |>
    dplyr::ungroup()
}

# Q4 K-S Test: Compare Eco Plus Short-haul vs Long-haul
ks_results_q4 <- NULL
if (exists("df_q4") && "cabin_distance" %in% colnames(df_q4)) {
  cabin_distance_levels <- unique(na.omit(df_q4$cabin_distance))
  eco_plus_levels <- cabin_distance_levels[grepl("Eco Plus", as.character(cabin_distance_levels))]
  
  if (length(eco_plus_levels) >= 2) {
    group1_q4 <- eco_plus_levels[grepl("Short", as.character(eco_plus_levels))][1]
    group2_q4 <- eco_plus_levels[grepl("Long", as.character(eco_plus_levels))][1]
    
    if (!is.na(group1_q4) && !is.na(group2_q4)) {
      ks_results_q4 <- purrr::map_dfr(service_columns, function(sv) {
        sub_data <- df_q4 |>
          dplyr::filter(cabin_distance %in% c(group1_q4, group2_q4), !is.na(.data[[sv]]))
        g1 <- sub_data |>
          dplyr::filter(cabin_distance == group1_q4) |>
          dplyr::pull(sv)
        g2 <- sub_data |>
          dplyr::filter(cabin_distance == group2_q4) |>
          dplyr::pull(sv)
        if (length(g1) >= 10 && length(g2) >= 10) {
          ks <- suppressWarnings(stats::ks.test(g1, g2))
          tibble::tibble(
            service = sv,
            group_a = as.character(group1_q4),
            group_b = as.character(group2_q4),
            statistic = unname(ks$statistic),
            p_value = ks$p.value
          )
        } else {
          tibble::tibble(
            service = sv,
            group_a = as.character(group1_q4),
            group_b = as.character(group2_q4),
            statistic = NA_real_,
            p_value = NA_real_
          )
        }
      })
    }
  }
}

# Q4 ANOVA: Interaction effects
anova_results_q4 <- NULL
if (exists("df_q4") && "cabin_factor" %in% colnames(df_q4) && "distance_factor" %in% colnames(df_q4)) {
  anova_results_q4 <- purrr::map_dfr(service_columns, function(sv) {
    model <- stats::aov(df_q4[[sv]] ~ df_q4$cabin_factor * df_q4$distance_factor, data = df_q4)
    smry <- summary(model)[[1]]
    tibble::tibble(
      service = sv,
      Cabin_F = smry$`F value`[1],
      Distance_F = smry$`F value`[2],
      Interaction_F = smry$`F value`[3],
      Cabin_p = smry$`Pr(>F)`[1],
      Distance_p = smry$`Pr(>F)`[2],
      Interaction_p = smry$`Pr(>F)`[3]
    )
  }) |>
    dplyr::arrange(Interaction_p)
}
```

## 3. Research Question Analysis

### 3.1 What is the relationship between passengers' overall satisfaction and their age as well as service demands?

This question aims to determine how service priorities shift across age groups. Understanding age-differentiated service needs can help airlines tailor offerings—for example, improving digital experiences for younger travelers or enhancing comfort for older passengers.

#### 3.1.1 Heatmap of Average Ratings

\medskip

The heatmap below visualizes average scores for all 14 service dimensions by age group:

```{r fig-heatmap, echo=FALSE, fig.cap="Figure 3.1 Average service ratings by age group", fig.pos='H', out.width="75%"}
heatmap_plot <- ggplot(summary_scores, aes(x = service, y = age_group, fill = mean_score)) +
  geom_tile(color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "C", na.value = "grey90", limits = c(1, 5)) +
  labs(
    x = "Service",
    y = "Age group",
    fill = "Avg rating"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 40, hjust = 1),
    panel.grid = element_blank()
  )
heatmap_plot
```

\FloatBarrier

The figure shows that, across nearly all age groups, Inflight service, Baggage handling, and Seat comfort consistently receive high ratings. The <18 group shows distinctly lower evaluations for Inflight wifi and Online booking, suggesting less engagement with digital service interfaces. Passengers aged 46–55 and 56–65 show more uniform ratings, indicating consistent expectations across service dimensions. 66+ passengers show lower ratings for several technologically oriented services, implying potential digital accessibility concerns.

#### 3.1.2 Top-5 Services by Age Group

\medskip

To highlight priorities clearly, the following figure presents the Top-5 service dimensions for each age group:

```{r fig-top5, echo=FALSE, fig.cap="Figure 3.2 Top-5 services by age group", fig.pos='H', out.width="80%"}
bar_plot <- ggplot(top5_by_age, aes(x = service, y = mean_score, fill = age_group)) +
  geom_col(width = 0.7, show.legend = FALSE) +
  geom_text(aes(label = sprintf("%.2f", mean_score)), hjust = -0.15, size = 3) +
  coord_flip() +
  facet_wrap(~ age_group, scales = "free_y") +
  scale_y_continuous(limits = c(0, 5.2)) +
  labs(
    x = "Service",
    y = "Average rating"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )
bar_plot
```

\FloatBarrier

The figure indicates that, for <18, Inflight service, Baggage handling, and Departure/Arrival convenience dominate. For 18–25 and 26–35, technology-enabled services become more important. 36–55 groups show balanced appreciation across comfort, baggage, and entertainment. 66+ prioritizes Seat comfort, Inflight service, and Baggage handling, indicating the importance of physical comfort and ease of travel support.

#### 3.1.3 K–S Test: Distribution Differences in Service Ratings

\medskip

To statistically measure whether ratings differ in location across age groups, we performed a Two-Sample Kolmogorov–Smirnov test, comparing the youngest group (<18) and the oldest (66+) across all services.

```{r fig-ks, echo=FALSE, fig.cap="Figure 3.3 K–S test results", fig.pos='H', out.width="65%"}
if (!is.null(ks_results) && nrow(ks_results) > 0) {
  ggplot(ks_results, aes(x = reorder(service, p_value), y = -log10(p_value))) +
    geom_col(fill = "#4C78A8") +
    geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "red") +
    coord_flip() +
    labs(
      x = "Service",
      y = expression(-log[10](p))
    ) +
    theme_minimal(base_size = 12)
} else {
  cat("K–S test results are not available (insufficient data).")
}
```

\FloatBarrier

The figure shows that online boarding, Inflight service, Baggage handling, and Seat comfort show extremely significant differences (p << 0.001). These are core operational or digital touchpoints—suggesting younger and older passengers perceive them differently. Attributes such as Inflight wifi or Entertainment show minimal differences, implying similar distribution patterns across generations.

#### 3.1.4 Logistic Regression: Factors Associated with Satisfaction

\medskip

To analyze which services most strongly predict satisfaction while controlling for age group, we ran a logistic regression:

```{r fig-logit, echo=FALSE, fig.cap="Figure 3.4 Logistic regression", fig.pos='H', out.width="70%"}
if (!is.null(logit_top_terms) && nrow(logit_top_terms) > 0) {
  ggplot(logit_top_terms, aes(x = term_clean, y = estimate)) +
    geom_pointrange(aes(ymin = conf.low, ymax = conf.high), color = "#F58518") +
    geom_hline(yintercept = 1, linetype = "dashed", color = "grey40") +
    coord_flip() +
    labs(
      x = "Variables",
      y = "Odds ratio (OR)"
    ) +
    theme_minimal(base_size = 12) +
    theme(
      plot.title.position = "plot",
      plot.margin = margin(t = 10, r = 24, b = 10, l = 10)
    )
} else {
  cat("Logistic regression results are not available (insufficient data).")
}
```

\FloatBarrier

The logistic regression plot shows the service factors most strongly associated with passenger satisfaction. Each dot represents an odds ratio (OR) and the horizontal line is its 95% confidence interval, with OR = 1 indicating no effect. Services whose confidence intervals lie entirely to the right of 1—such as online boarding, inflight wifi, leg room service, and inflight entertainment—significantly increase the likelihood of satisfaction, even after controlling for other variables.

The plot also includes terms such as age_group.L, age_group.Q, and higher-order contrasts. These represent overall age trends rather than specific age groups. Their significance indicates that age-related patterns still influence satisfaction, complementing the effects of individual service ratings. Overall, the figure highlights both key service drivers of satisfaction and the continued role of demographic age trends.

#### 3.1.5 Conclusion for Q1

Combining all analyses, different age groups prioritize different service attributes. Younger groups emphasize digital services. Older groups emphasize comfort and travel assistance. Distribution differences are statistically significant for several services, confirming that age shapes service perception.

Overall, age is a meaningful moderator of service experience, and airlines can improve satisfaction by: enhancing digital touchpoints for younger passengers; enhancing comfort and support for older passengers; ensuring high reliability in universal services like baggage handling and inflight service.

### 3.2 Do passengers place higher ratings or importance on "entertainment" and "catering" for longer flights?

### 3.3 How do departure and arrival delays influence passenger satisfaction differently between loyal and disloyal customers?

### 3.4 What are the moderating effects of the intersection of cabin class and flight distance on certain service attributes and passenger satisfaction?

Customers do not perceive service attributes the same way. The value attached to certain service attributes is likely to vary with the context of travel such as long-haul vs short-haul and the willingness to pay cabin class. In order to help airlines improve, by analyzing passengers' satisfaction rate tells the airline where to focus their efforts to get the biggest return in retention, and revenue for each additional service dollar spent.

#### 3.4.1 Heatmap of Average Ratings

\medskip

To visualize the landscape of passenger sentiment, we aggregated average service scores across the intersection of three cabin classes and three flight distance categories (Short, Medium, Long-haul):

```{r fig-heatmap-q4, echo=FALSE, fig.cap="Figure 3.5 Heatmap of Average Ratings", fig.pos='H', out.width="75%"}
if (!is.null(heatmap_q4) && nrow(heatmap_q4) > 0) {
  ggplot(heatmap_q4, aes(x = service, y = cabin_distance, fill = mean_score)) +
    geom_tile(color = "white", size = 0.2) +
    scale_fill_viridis_c(option = "C", na.value = "grey90", limits = c(1, 5)) +
    labs(
      x = "Service",
      y = "Cabin Class × Flight Distance",
      fill = "Avg rating"
    ) +
    theme_minimal(base_size = 12) +
    theme(
      axis.text.x = element_text(angle = 40, hjust = 1),
      axis.text.y = element_text(size = 8),
      panel.grid = element_blank()
    )
} else {
  cat("Heatmap data is not available.")
}
```

\FloatBarrier

The heatmap reveals a distinct "comfort gap" that widens with distance. Business class passengers maintain consistently high average ratings (indicated by orange and yellow hues) across almost all service dimensions, regardless of flight length. In contrast, "Eco Plus × Long-haul" and "Eco × Long-haul" clusters display deep purple shades, indicating significantly lower satisfaction scores. This suggests that while premium cabins effectively insulate passengers from the fatigue of long-haul travel, the value proposition of Economy and Economy Plus deteriorates as flight duration increases, particularly regarding "Leg room service" and "Inflight entertainment."

#### 3.4.2 Top-5 Services by Cabin Class × Flight Distance

\medskip

We further decomposed the data to identify which service dimensions receive the highest praise in each specific travel scenario:

```{r fig-top5-q4, echo=FALSE, fig.cap="Figure 3.6 Top-5 Services by Cabin Class × Flight Distance", fig.pos='H', out.width="85%"}
if (!is.null(top5_q4) && nrow(top5_q4) > 0) {
  ggplot(top5_q4, aes(x = reorder(service, mean_score), y = mean_score, fill = mean_score)) +
    geom_col(width = 0.7, show.legend = FALSE) +
    geom_text(aes(label = sprintf("%.2f", mean_score)), hjust = -0.15, size = 2.5) +
    coord_flip() +
    facet_wrap(~ cabin_distance, scales = "free_y", ncol = 3) +
    scale_fill_viridis_c(option = "C", limits = c(1, 5), guide = "none") +
    scale_y_continuous(limits = c(0, 5.2)) +
    labs(
      x = "Service",
      y = "Average rating"
    ) +
    theme_minimal(base_size = 11) +
    theme(
      axis.text = element_text(size = 7),
      strip.text = element_text(size = 8),
      panel.grid.major.y = element_blank(),
      panel.grid.minor = element_blank()
    )
} else {
  cat("Top-5 data is not available.")
}
```

\FloatBarrier

This visualization highlights a shift in passenger priorities. For Short-haul flights ($<1000$ km) across all classes, operational services such as "Baggage handling" and "Inflight service" consistently appear in the top 5, suggesting that efficiency is the primary driver of satisfaction for quick trips. However, as we move to Long-haul ($>3000$ km) segments, "Seat comfort" and "Inflight entertainment" rise to prominence, particularly in Business class. Notably, in the "Eco × Long-haul" sector, "Leg room service" appears in the top-rated services, likely because it is a scarce but highly valued commodity on long durations. This confirms that the definition of a "good flight" changes fundamentally based on the duration and class interaction.

#### 3.4.3 K–S Test: Distribution Differences (Eco Plus Short-haul vs. Long-haul)

\medskip

To statistically validate if the flight duration fundamentally changes the service experience within a single cabin class, we performed a Kolmogorov–Smirnov (K–S) test comparing Eco Plus Short-haul against Eco Plus Long-haul:

```{r fig-ks-q4, echo=FALSE, fig.cap="Figure 3.7 K–S Test Results (Eco Plus Short vs. Long)", fig.pos='H', out.width="65%"}
if (!is.null(ks_results_q4) && nrow(ks_results_q4) > 0) {
  ggplot(ks_results_q4, aes(x = reorder(service, p_value), y = -log10(p_value))) +
    geom_col(fill = "#4C78A8") +
    geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "red") +
    coord_flip() +
    labs(
      x = "Service",
      y = expression(-log[10](p)),
      title = paste("K–S Test:", ks_results_q4$group_a[1], "vs", ks_results_q4$group_b[1])
    ) +
    theme_minimal(base_size = 12)
} else {
  cat("K–S test results are not available (insufficient data).")
}
```

\FloatBarrier

The results show that "Inflight service" has the most statistically significant distributional difference ($-\log_{10}(p-\text{value})>1.5$) between short and long flights. This implies that the human element—how flight attendants interact with passengers—is perceived very differently on long flights compared to short hops for Eco Plus passengers. Other physical attributes like "Leg room service" and "Inflight entertainment" also show significant variance, reinforcing the idea that the "Plus" in Economy Plus is scrutinized much more heavily when the passenger is confined to the seat for longer periods.

#### 3.4.4 ANOVA: Interaction Effects

\medskip

Moving beyond simple comparisons, we used Analysis of Variance (ANOVA) to quantify the strength of the interaction effect between Cabin Class and Flight Distance on specific services:

```{r fig-anova-q4, echo=FALSE, fig.cap="Figure 3.8 ANOVA Interaction Effects", fig.pos='H', out.width="65%"}
if (!is.null(anova_results_q4) && nrow(anova_results_q4) > 0) {
  anova_plot_data <- anova_results_q4 |>
    dplyr::mutate(neg_log10_p = -log10(Interaction_p))
  
  ggplot(anova_plot_data, aes(x = reorder(service, Interaction_p), y = neg_log10_p)) +
    geom_col(fill = "#2E7D32", alpha = 0.8) +
    geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "red") +
    coord_flip() +
    labs(
      x = "Service",
      y = expression(-log[10](p) ~ "for Interaction")
    ) +
    theme_minimal(base_size = 12)
} else {
  cat("ANOVA results are not available.")
}
```

\FloatBarrier

The green bars represent the significance of the interaction. "Seat comfort" displays the massive interaction effect ($-\log_{10}(p-\text{value})>50$). This indicates that the impact of seat comfort on satisfaction is not just about the seat itself, but is heavily dependent on the specific combination of how long the flight is and what class the passenger is in. "Inflight entertainment" and "Online boarding" also show strong interaction effects. This suggests that airlines cannot treat these services with a "one size fits all" strategy; the return on investment for improving seat comfort is significantly higher for specific class-distance combinations (likely Long-haul/Economy sectors) than others.

#### 3.4.5 Conclusion for Q4

The intersection of cabin class and flight distance exerts a powerful moderating effect on passenger satisfaction. While operational efficiency (boarding, baggage) is universally appreciated, the hierarchy of needs shifts toward physical comfort (seat, legroom) and entertainment as flight distance increases. The analysis shows that premium cabins successfully mitigate the "distance penalty," whereas Economy and Economy Plus passengers experience a significant drop in satisfaction on long-haul routes. For airlines, this suggests that investment in "soft products" (service and entertainment) and digital ease (online boarding) is critical to maintaining satisfaction in lower cabin classes on long routes.

### 3.5 Can we accurately predict passenger satisfaction, and which factors are the most important predictors?

This research question evaluates whether passenger satisfaction can be predicted with sufficient accuracy to be useful for airline decision-making, and identifies which service and customer attributes most strongly drive the predictions. We combine tree-based machine learning models with cross-validation to assess out-of-sample performance and to derive robust measures of feature importance.

```{r rq5-data-load, include=FALSE, message=FALSE, warning=FALSE}
## Load model evaluation results
model_eval <- readr::read_csv("output/zliu134/models/model_evaluation.csv", show_col_types = FALSE)
feature_imp <- readr::read_csv("output/zliu134/models/combined_feature_importance.csv", show_col_types = FALSE)

## Extract key metrics
rf_accuracy <- model_eval$Accuracy[model_eval$Model == "Random Forest"]
xgb_accuracy <- model_eval$Accuracy[model_eval$Model == "XGBoost"]
rf_auc <- model_eval$AUC[model_eval$Model == "Random Forest"]
xgb_auc <- model_eval$AUC[model_eval$Model == "XGBoost"]
rf_sensitivity <- model_eval$Sensitivity[model_eval$Model == "Random Forest"]
xgb_sensitivity <- model_eval$Sensitivity[model_eval$Model == "XGBoost"]
rf_specificity <- model_eval$Specificity[model_eval$Model == "Random Forest"]
xgb_specificity <- model_eval$Specificity[model_eval$Model == "XGBoost"]
rf_precision <- model_eval$Precision[model_eval$Model == "Random Forest"]
xgb_precision <- model_eval$Precision[model_eval$Model == "XGBoost"]
rf_f1 <- model_eval$F1[model_eval$Model == "Random Forest"]
xgb_f1 <- model_eval$F1[model_eval$Model == "XGBoost"]

## Top features
top_feature <- feature_imp$Feature[1]
top_feature_importance <- feature_imp$Average_Importance[1]
second_feature <- feature_imp$Feature[2]
second_feature_importance <- feature_imp$Average_Importance[2]
```

#### 3.5.1 Modelling approach

We treat **satisfaction** as a binary outcome with two levels: *neutral_or_dissatisfied* vs. *satisfied*, where *neutral_or_dissatisfied* is coded as the negative class and *satisfied* as the positive class. The models use a rich set of predictors combining:

- **Service ratings (14 dimensions)**: inflight wifi, online booking, gate location, food and drink, online boarding, seat comfort, inflight entertainment, on-board and inflight service, leg room, baggage handling, check-in service, cleanliness, and departure/arrival convenience.
- **Engineered service index**: the **service_score**, computed as the average of all service ratings to capture overall perceived service quality.
- **Operational variables**: age, flight distance, departure delay and arrival delay.
- **Customer and travel characteristics** (one-hot encoded): gender, customer type (loyal vs. disloyal), type of travel (business vs. personal), and travel class.

The data are randomly split into an **80% training set** and a **20% test set** using **stratified sampling** to preserve the class proportion of satisfied vs. neutral/dissatisfied passengers. On the training set, we fit two tree-based classifiers:

- A **Random Forest (RF)** model with 500 trees and $\sqrt{p}$ variables tried at each split.
- An **XGBoost** gradient boosting model with a binary logistic objective and AUC as the optimization metric.

To obtain robust performance estimates, both models are further evaluated using **k-fold cross-validation** (here, k = 5) with the `caret` framework and `twoClassSummary`, reporting cross-validated accuracy and AUC in addition to test-set results.

#### 3.5.2 Overall predictive performance

\medskip

Figure 5.1 compares the **test-set accuracy** of the Random Forest and XGBoost models. Both models achieve relatively high accuracy, indicating that the combination of service ratings and operational variables contains substantial information about whether a passenger will report being satisfied. In our sample, the XGBoost model attains the highest accuracy (`r sprintf("%.1f%%", xgb_accuracy * 100)`), with the Random Forest performing slightly lower but still strong (`r sprintf("%.1f%%", rf_accuracy * 100)`).

```{r fig-accuracy, echo=FALSE, fig.cap="Figure 5.1 Model accuracy comparison", fig.pos='H', out.width="65%"}
knitr::include_graphics("output/zliu134/figures/01_accuracy_comparison.png")
```

\FloatBarrier

Figure 5.2 summarizes a broader set of metrics—**sensitivity, specificity, precision, F1 score, and AUC**—for both models. Across these indicators, XGBoost again performs marginally better, with an AUC above `r sprintf("%.3f", xgb_auc)` and a balanced trade-off between correctly identifying satisfied passengers (high sensitivity: `r sprintf("%.1f%%", xgb_sensitivity * 100)`) and correctly recognizing neutral/dissatisfied passengers (high specificity: `r sprintf("%.1f%%", xgb_specificity * 100)`). The Random Forest's metrics are comparable (AUC: `r sprintf("%.3f", rf_auc)`, Sensitivity: `r sprintf("%.1f%%", rf_sensitivity * 100)`, Specificity: `r sprintf("%.1f%%", rf_specificity * 100)`), suggesting that the results are not driven by a single modelling choice.

```{r fig-metrics, echo=FALSE, fig.cap="Figure 5.2 Comprehensive model performance metrics", fig.pos='H', out.width="75%"}
knitr::include_graphics("output/zliu134/figures/02_comprehensive_metrics.png")
```

\FloatBarrier

Figure 5.3 presents the **ROC curves** for both models. The curves lie well above the diagonal no-information line, with areas under the curve (AUC) in the high-performance range (RF AUC = `r sprintf("%.3f", rf_auc)`; XGB AUC = `r sprintf("%.3f", xgb_auc)`). This confirms that the models discriminate well between satisfied and neutral/dissatisfied passengers across a range of classification thresholds, not just at the default 0.5 cutoff.

```{r fig-roc, echo=FALSE, fig.cap="Figure 5.3 ROC curves comparison", fig.pos='H', out.width="65%"}
knitr::include_graphics("output/zliu134/figures/03_roc_curves.png")
```

\FloatBarrier

Finally, the **confusion matrices** in Figure 5.4 show the distribution of correct and incorrect classifications for each model. Most observations are correctly classified, with misclassifications concentrated among "borderline" cases between neutral and satisfied. Compared with a naïve baseline (e.g., always predicting the majority class), both models substantially reduce error rates.

```{r fig-confusion, echo=FALSE, fig.cap="Figure 5.4 Confusion matrices for Random Forest and XGBoost", fig.pos='H', out.width="85%"}
if (!requireNamespace("png", quietly = TRUE)) install.packages("png", repos = "https://cran.rstudio.com/")
if (!requireNamespace("gridExtra", quietly = TRUE)) install.packages("gridExtra", repos = "https://cran.rstudio.com/")
library(png)
library(gridExtra)
p1 <- grid::rasterGrob(readPNG("output/zliu134/figures/06a_confusion_matrix_rf.png"), interpolate = TRUE)
p2 <- grid::rasterGrob(readPNG("output/zliu134/figures/06b_confusion_matrix_xgb.png"), interpolate = TRUE)
grid.arrange(p1, p2, ncol = 2)
```

\FloatBarrier

Taken together, these results indicate that **passenger satisfaction is indeed predictable with reasonably high accuracy**, and that the predictive signal is stable across different tree-based algorithms.

#### 3.5.3 Most important predictors of satisfaction

\medskip

To address the second part of RQ5, we examine **feature importance** from both Random Forest and XGBoost. For Random Forest, we use the **MeanDecreaseGini** metric, while XGBoost uses **Gain**. Because these measures are not directly comparable, we normalize them to a 0–100 scale and average them across the two models. Figure 5.5 displays the **Top-15 predictors ranked by this average normalized importance**, grouped into service ratings, customer demographics, and other features.

```{r fig-top-features, echo=FALSE, fig.cap="Figure 5.5 Top 15 most important predictors (average of both models)", fig.pos='H', out.width="75%"}
knitr::include_graphics("output/zliu134/figures/04_top_features_combined.png")
```

\FloatBarrier

Three clear patterns emerge:

1. **Service quality dominates**  
   Overall and specific service ratings are consistently the strongest predictors. The most important single predictor is **Online boarding** (average normalized importance: `r sprintf("%.1f", top_feature_importance)`), followed by **Inflight wifi service** (`r sprintf("%.1f", second_feature_importance)`). The engineered **service_score** (average rating across 14 services) ranks sixth with an importance of `r sprintf("%.1f", feature_imp$Average_Importance[feature_imp$Feature == "service_score"])`, confirming that passengers' global perception of service quality closely aligns with their final satisfaction label. Among individual dimensions, factors such as:
   - **Online boarding** (most important)
   - **Inflight wifi service**  
   - **Inflight entertainment**  
   - **Seat comfort**  
   - **Leg room service**  
   - **Baggage handling**  
   - **Cleanliness**  
   typically appear among the most important features. This suggests that **core service execution and comfort on the flight** are central to satisfaction.

2. **Customer and travel context are meaningful predictors**  
   Dummy variables for **Type.of.Travel (business vs. personal)** and **Class (business vs. economy)** appear as important predictors, ranking third and fifth respectively. Business travel is associated with higher satisfaction probability (importance: `r sprintf("%.1f", feature_imp$Average_Importance[feature_imp$Feature == "Type.of.Travel.Business travel"])`), as is business class (importance: `r sprintf("%.1f", feature_imp$Average_Importance[feature_imp$Feature == "Class.Business"])`). This indicates that **expectations and reference points** differ across these groups, with business travelers and higher-class passengers having distinct satisfaction profiles even after controlling for service ratings.

3. **Operational variables show moderate importance**  
   Operational variables such as **flight distance** and **arrival delay** show moderate importance (ranked 18th and 24th respectively), with longer delays reducing the probability of a passenger being classified as satisfied. However, their importance is lower than service ratings and travel context, suggesting that **service quality matters more than operational disruptions** in determining satisfaction.

The model-specific comparison in Figure 5.6 shows that Random Forest and XGBoost largely agree on which features are important, strengthening the robustness of these findings.

```{r fig-feature-compare, echo=FALSE, fig.cap="Figure 5.6 Feature importance: RF vs XGBoost comparison", fig.pos='H', out.width="75%"}
knitr::include_graphics("output/zliu134/figures/05_feature_importance_comparison.png")
```

\FloatBarrier

#### 3.5.4 How do key features shape satisfaction? (Partial dependence)

\medskip

To better interpret the effect of the most influential predictors, we generate a **partial dependence plot (PDP)** for the top feature (**Online boarding**) using the XGBoost model (Figure 5.7). Holding other variables constant, predicted satisfaction probability increases **monotonically** with higher online boarding service ratings. The curve shows that as online boarding service quality improves from low to high ratings, the predicted probability of satisfaction increases substantially, indicating that this service dimension has a strong direct effect on passenger satisfaction.

```{r fig-pdp, echo=FALSE, fig.cap="Figure 5.7 Partial dependence plot for Online boarding (top predictor)", fig.pos='H', out.width="65%"}
knitr::include_graphics("output/zliu134/figures/07_pdp_Online_boarding.png")
```

\FloatBarrier

The partial dependence plot demonstrates that **Online boarding service** has a strong, positive relationship with satisfaction probability. Passengers who rate online boarding highly are substantially more likely to be satisfied, even when controlling for all other service dimensions and passenger characteristics. This finding highlights the importance of digital service touchpoints in the modern airline experience.

#### 3.5.5 Conclusion for RQ5

In summary, the modelling results provide a clear answer to RQ5:

- **Predictive accuracy**: Using tree-based methods (Random Forest and XGBoost), we can **accurately predict passenger satisfaction**, achieving high accuracy (`r sprintf("%.1f%%", max(rf_accuracy, xgb_accuracy) * 100)`) and AUC (`r sprintf("%.3f", max(rf_auc, xgb_auc))`) on a held-out test set and consistent performance under cross-validation. This suggests that airlines can use routinely collected survey and operations data to anticipate satisfaction outcomes with good reliability.

- **Key predictors**: The most important drivers of predicted satisfaction are:
  1. **Online boarding service**, which emerges as the single most critical predictor (normalized importance: `r sprintf("%.1f", top_feature_importance)`).
  2. **Inflight wifi service**, ranking second in importance (`r sprintf("%.1f", second_feature_importance)`).
  3. **Travel context** (business vs. personal travel, business vs. economy class), which significantly influences satisfaction expectations.
  4. **Other service dimensions** such as inflight entertainment, seat comfort, and the composite service score.

These findings reinforce that **satisfaction is shaped primarily by service quality, with digital touchpoints (online boarding, wifi) being particularly critical**. For managers, the models can be used not only to forecast satisfaction, but also to prioritize interventions—for example, investing in online boarding infrastructure and inflight connectivity, or customizing service offers for different customer segments and travel purposes.

## 4. Insight Gained

## 5. Project Adjustment & Lesson Learned

## 6. Team Collaboration

## 7. Future Directions

## 8. Conclusion
